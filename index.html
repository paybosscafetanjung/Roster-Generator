<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payboss Roster Generator</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- ICON COMPONENTS ---
        const Icons = {
            Coffee: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            RefreshCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
            LayoutDashboard: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            UserCheck: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>,
            Users: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            BarChart3: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Edit: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
            X: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Save: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Alert: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            Rotate: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>,
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>
        };

        const INITIAL_EMPLOYEES = [
            { id: 'k1', name: 'Komang Sri Yati Utami', role: 'Kitchen', rank: 'Senior' },
            { id: 'k2', name: 'Shada Amalia', role: 'Kitchen', rank: 'Junior' },
            { id: 'k3', name: 'Iqbal Arasyid', role: 'Kitchen', rank: 'Mid' },
            { id: 'k4', name: 'Fitri Ainur Sabita', role: 'Kitchen', rank: 'Mid' },
            { id: 'k5', name: 'Ovy Putri Novia', role: 'Kitchen', rank: 'Junior' },
            { id: 'b1', name: 'Hidayatur Rahman', role: 'Barista', rank: 'Leader' }, 
            { id: 'b2', name: 'Renita Aulia Jasmin', role: 'Barista', rank: 'Mid' },
            { id: 'b3', name: 'Ansyari Fachmi Ridani', role: 'Barista', rank: 'Mid' },
            { id: 'b4', name: 'Ahmad Maulidan Noor', role: 'Barista', rank: 'Junior' },
            { id: 'b5', name: 'Samlawi', role: 'Barista', rank: 'Junior' },
            { id: 'c1', name: 'Nahjatus Sabela', role: 'Kasir', rank: 'Senior' },
            { id: 'c2', name: 'Jihan Permata Sari', role: 'Kasir', rank: 'Mid' },
            { id: 'c3', name: 'Rusdhani', role: 'Kasir', rank: 'Junior' },
            { id: 's1', name: 'Ilham Ali Naufal', role: 'Server', rank: 'Mid' },
            { id: 's2', name: 'Rifky Arya Ramadhani', role: 'Server', rank: 'Mid' },
            { id: 's3', name: 'Muhammad Zikrillah', role: 'Server', rank: 'Junior' },
            { id: 's4', name: 'Vacan (Freelance)', role: 'Server', rank: 'Junior' },
        ];

        const DAYS = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
        const WEEKEND_DAYS = ['Jumat', 'Sabtu', 'Minggu'];
        const WEEKS = [1, 2, 3, 4];
        const ROLES = ['Kitchen', 'Barista', 'Kasir', 'Server'];
        const RANKS = ['Junior', 'Mid', 'Senior', 'Leader'];

        const StatCard = ({ icon, title, value, desc, colorClass }) => {
            const IconComponent = Icons[icon];
            return (
                <div className={`p-4 rounded-xl border ${colorClass} shadow-sm`}>
                    <div className="flex items-center justify-between mb-2">
                        <h3 className="text-sm font-semibold opacity-80">{title}</h3>
                        <IconComponent size={20} />
                    </div>
                    <div className="text-2xl font-bold">{value}</div>
                    <div className="text-xs opacity-70 mt-1">{desc}</div>
                </div>
            );
        };

        function PaybossRoster() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [activeWeek, setActiveWeek] = useState(1);
            const [rosterData, setRosterData] = useState(null);
            const [monthlyStats, setMonthlyStats] = useState(null); // Data laporan bulanan
            const [employees, setEmployees] = useState(INITIAL_EMPLOYEES);

            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingId, setEditingId] = useState(null); 
            const [formData, setFormData] = useState({ name: '', role: 'Barista', rank: 'Junior' });

            const handleOpenModal = (employee = null) => {
                if (employee) {
                    setEditingId(employee.id);
                    setFormData({ name: employee.name, role: employee.role, rank: employee.rank });
                } else {
                    setEditingId(null);
                    setFormData({ name: '', role: 'Barista', rank: 'Junior' });
                }
                setIsModalOpen(true);
            };

            const handleSaveEmployee = (e) => {
                e.preventDefault();
                if (!formData.name.trim()) return;
                if (editingId) {
                    setEmployees(employees.map(emp => emp.id === editingId ? { ...emp, ...formData } : emp));
                } else {
                    const newEmployee = { id: Date.now().toString(), ...formData };
                    setEmployees([...employees, newEmployee]);
                }
                setIsModalOpen(false);
            };

            const handleDeleteEmployee = (id) => {
                if (window.confirm('Yakin ingin menghapus data karyawan ini?')) {
                    setEmployees(employees.filter(emp => emp.id !== id));
                }
            };

            const shuffle = (array) => [...array].sort(() => Math.random() - 0.5);

            // --- FUNGSI HITUNG STATISTIK BULANAN ---
            const calculateStats = (data, employeeList) => {
                let stats = {};
                // Inisialisasi
                employeeList.forEach(e => {
                    stats[e.id] = { 
                        name: e.name, 
                        role: e.role, 
                        totalWorkDays: 0, 
                        totalOffDays: 0, 
                        totalHours: 0 
                    };
                });

                Object.values(data).forEach(week => {
                    Object.values(week).forEach(day => {
                        // Shift 1: 8 Jam
                        day.s1.forEach(e => {
                            if(stats[e.id]) {
                                stats[e.id].totalWorkDays++;
                                stats[e.id].totalHours += 8;
                            }
                        });
                        // Shift 2: 7 Jam
                        day.s2.forEach(e => {
                            if(stats[e.id]) {
                                stats[e.id].totalWorkDays++;
                                stats[e.id].totalHours += 7;
                            }
                        });
                        // Shift 3: 9 Jam (Overlap maupun Normal tetap 9 Jam)
                        day.s3.forEach(e => {
                            if(stats[e.id]) {
                                stats[e.id].totalWorkDays++;
                                stats[e.id].totalHours += 9;
                            }
                        });
                        // Off
                        day.off.forEach(e => {
                            if(stats[e.id]) {
                                stats[e.id].totalOffDays++;
                            }
                        });
                    });
                });
                return stats;
            };

            const generateMonthRoster = () => {
                let monthData = {};
                let offPointer = 0; 

                WEEKS.forEach(weekNum => {
                    let weekRoster = {};
                    DAYS.forEach(day => {
                        let dailyAssignment = { s1: [], s2: [], s3: [], off: [] };

                        // Rolling Off Logic
                        let todaysOffIds = [];
                        for(let i=0; i<3; i++) {
                             const index = offPointer % employees.length;
                             todaysOffIds.push(employees[index].id);
                             offPointer++; 
                        }

                        let availableForWork = employees.filter(e => !todaysOffIds.includes(e.id));
                        
                        let poolKitchen = shuffle(availableForWork.filter(e => e.role === 'Kitchen'));
                        let poolBarista = shuffle(availableForWork.filter(e => e.role === 'Barista'));
                        let poolKasir = shuffle(availableForWork.filter(e => e.role === 'Kasir'));
                        let poolServer = shuffle(availableForWork.filter(e => e.role === 'Server'));

                        const pickStaff = (rolePool, preferredRole) => {
                            if (rolePool.length > 0) return rolePool.pop();
                            if (preferredRole === 'Kitchen' || preferredRole === 'Barista' || preferredRole === 'Kasir') {
                                if (poolServer.length > 0) {
                                    const sub = poolServer.pop();
                                    sub.isSubstitute = true; 
                                    return sub;
                                }
                            }
                            return null;
                        };

                        // Shift Assignment
                        for(let i=0; i<3; i++) { const s = pickStaff(poolKitchen, 'Kitchen'); if(s) dailyAssignment.s2.push(s); }
                        const leader = poolBarista.find(b => b.rank === 'Leader');
                        if(leader) {
                            poolBarista = poolBarista.filter(b => b.id !== leader.id);
                            dailyAssignment.s2.push(leader);
                            const s = pickStaff(poolBarista, 'Barista'); if(s) dailyAssignment.s2.push(s);
                        } else {
                            for(let i=0; i<2; i++) { const s = pickStaff(poolBarista, 'Barista'); if(s) dailyAssignment.s2.push(s); }
                        }
                        for(let i=0; i<2; i++) { const s = pickStaff(poolServer, 'Server'); if(s) dailyAssignment.s2.push(s); }
                        for(let i=0; i<1; i++) { const s = pickStaff(poolKasir, 'Kasir'); if(s) dailyAssignment.s2.push(s); }

                        const s1K = pickStaff(poolKitchen, 'Kitchen'); if(s1K) dailyAssignment.s1.push(s1K);
                        const s1B = pickStaff(poolBarista, 'Barista'); if(s1B) dailyAssignment.s1.push(s1B);
                        if(poolServer.length > 0) dailyAssignment.s1.push(poolServer.pop());
                        else if(poolKasir.length > 0) dailyAssignment.s1.push(poolKasir.pop());

                        let overlapCandidate = null;
                        const s3K = pickStaff(poolKitchen, 'Kitchen'); if(s3K) dailyAssignment.s3.push(s3K);
                        if(poolBarista.length > 0) {
                            overlapCandidate = poolBarista.pop();
                            dailyAssignment.s3.push(overlapCandidate);
                        } else if(poolServer.length > 0) {
                            overlapCandidate = poolServer.pop();
                            dailyAssignment.s3.push(overlapCandidate);
                        }
                        const s3C = pickStaff(poolKasir, 'Kasir'); if(s3C) dailyAssignment.s3.push(s3C);

                        const isWeekend = WEEKEND_DAYS.includes(day);
                        if (isWeekend && overlapCandidate) {
                            const index = dailyAssignment.s3.findIndex(e => e.id === overlapCandidate.id);
                            if(index !== -1) {
                                dailyAssignment.s3[index] = { ...dailyAssignment.s3[index], isOverlap: true };
                            }
                        }

                        dailyAssignment.off = employees.filter(e => todaysOffIds.includes(e.id));
                        weekRoster[day] = dailyAssignment;
                    });
                    monthData[weekNum] = weekRoster;
                });
                
                // Kalkulasi Laporan setelah generate
                const stats = calculateStats(monthData, employees);
                setMonthlyStats(stats);
                setRosterData(monthData);
                setActiveTab('report'); // Langsung pindah ke tab report
                setActiveWeek(1);
            };

            const currentRoster = rosterData ? rosterData[activeWeek] : {};

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 font-sans pb-10">
                    <header className="bg-slate-900 text-white p-4 shadow-lg sticky top-0 z-40">
                        <div className="max-w-5xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <Icons.Coffee className="text-amber-400" size={24} />
                                    Payboss Roster
                                </h1>
                                <p className="text-xs text-slate-400">Strategi Asimetris & Rolling Off</p>
                            </div>
                            <button onClick={generateMonthRoster} className="bg-amber-500 hover:bg-amber-600 text-black px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 transition-all shadow-amber-500/20 shadow-lg">
                                <Icons.RefreshCw size={16} /> Generate Jadwal
                            </button>
                        </div>
                    </header>

                    <main className="max-w-5xl mx-auto p-4">
                        <div className="flex flex-col sm:flex-row gap-4 mb-6 justify-between items-start sm:items-center">
                            <div className="flex gap-2 overflow-x-auto pb-2 sm:pb-0">
                                <button onClick={() => setActiveTab('dashboard')} className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${activeTab === 'dashboard' ? 'bg-slate-900 text-white' : 'bg-white text-slate-600 border'}`}>
                                    <Icons.LayoutDashboard size={16} /> Dashboard
                                </button>
                                <button onClick={() => setActiveTab('roster')} className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${activeTab === 'roster' ? 'bg-slate-900 text-white' : 'bg-white text-slate-600 border'}`}>
                                    <Icons.UserCheck size={16} /> Jadwal Aktif
                                </button>
                                <button onClick={() => setActiveTab('report')} className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${activeTab === 'report' ? 'bg-slate-900 text-white' : 'bg-white text-slate-600 border'}`}>
                                    <Icons.FileText size={16} /> Laporan Bulanan
                                </button>
                                <button onClick={() => setActiveTab('employees')} className={`px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 ${activeTab === 'employees' ? 'bg-slate-900 text-white' : 'bg-white text-slate-600 border'}`}>
                                    <Icons.Users size={16} /> Database
                                </button>
                            </div>
                        </div>

                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <StatCard icon="Sun" title="Shift 1: Pagi" value="3 Orang" desc="08:00 - 16:00 (Prep)" colorClass="bg-blue-50 border-blue-200 text-blue-900" />
                                    <StatCard icon="Zap" title="Shift 2: SORE" value="8 Orang" desc="16:00 - 23:00 (Prime Time)" colorClass="bg-amber-50 border-amber-400 text-amber-900 ring-2 ring-amber-400/20" />
                                    <StatCard icon="Moon" title="Shift 3: Malam" value="3 Orang" desc="23:00 - 08:00 (Closing)" colorClass="bg-indigo-50 border-indigo-200 text-indigo-900" />
                                </div>
                                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2">
                                        <Icons.Rotate size={20} className="text-green-500"/>
                                        Solusi: Rolling Off (Libur Bergilir)
                                    </h2>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-100">
                                            <h3 className="font-bold text-green-900 flex items-center gap-2"><Icons.UserCheck size={16}/> Distribusi Merata</h3>
                                            <p className="text-sm text-slate-700 mt-1">
                                                Tidak ada lagi penumpukan libur di hari Minggu. Sistem merotasi 3 orang libur setiap harinya secara urut.
                                            </p>
                                        </div>
                                        <div className="bg-amber-50 p-4 rounded-lg border border-amber-100">
                                            <h3 className="font-bold text-amber-900 flex items-center gap-2"><Icons.Zap size={16}/> Minggu Full Team</h3>
                                            <p className="text-sm text-slate-700 mt-1">
                                                Dijamin hari Minggu tetap memiliki 14 staff aktif, karena kuota libur disebar rata ke Senin-Sabtu juga.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'roster' && (
                            <div className="space-y-6">
                                {!rosterData ? (
                                    <div className="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                                        <Icons.Coffee size={48} className="mx-auto text-slate-300 mb-4" />
                                        <p className="text-slate-500 mb-4">Belum ada jadwal yang dibuat.</p>
                                        <button onClick={generateMonthRoster} className="bg-slate-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-slate-800">Generate Jadwal Bulan Ini</button>
                                    </div>
                                ) : (
                                    <>
                                        <div className="flex items-center gap-2 bg-white p-2 rounded-lg border border-slate-200 shadow-sm overflow-x-auto">
                                            <span className="text-xs font-bold text-slate-500 px-2 uppercase">Pilih Minggu:</span>
                                            {WEEKS.map(w => (
                                                <button key={w} onClick={() => setActiveWeek(w)} className={`px-4 py-2 rounded-md text-sm font-bold transition-all whitespace-nowrap ${activeWeek === w ? 'bg-amber-500 text-white shadow-md' : 'hover:bg-slate-100 text-slate-600'}`}>Minggu {w}</button>
                                            ))}
                                        </div>
                                        <div className="grid gap-6">
                                            {DAYS.map((day) => (
                                                <div key={day} className={`bg-white rounded-xl shadow-sm border overflow-hidden ${WEEKEND_DAYS.includes(day) ? 'border-amber-200 ring-1 ring-amber-100' : 'border-slate-200'}`}>
                                                    <div className={`px-4 py-2 border-b flex justify-between items-center ${WEEKEND_DAYS.includes(day) ? 'bg-amber-50' : 'bg-slate-100 border-slate-200'}`}>
                                                        <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                                                            {day} 
                                                            {WEEKEND_DAYS.includes(day) && <span className="text-[10px] bg-red-500 text-white px-1.5 py-0.5 rounded font-bold">SUPER PEAK</span>}
                                                        </h3>
                                                        <span className="text-xs bg-white px-2 py-1 rounded border border-slate-300 text-slate-500 hidden sm:inline-block">Libur: {currentRoster[day].off.length}</span>
                                                    </div>
                                                    <div className="grid md:grid-cols-4 divide-y md:divide-y-0 md:divide-x divide-slate-100">
                                                        {/* SHIFT 1 */}
                                                        <div className="p-4 bg-blue-50/30">
                                                            <div className="flex items-center gap-2 mb-3"><span className="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded">PAGI (3)</span></div>
                                                            <ul className="space-y-2">
                                                                {currentRoster[day].s1.map(staff => (
                                                                    <li key={staff.id} className="text-sm flex items-start gap-2">
                                                                        <span className={`w-2 h-2 mt-1.5 rounded-full ${staff.role === 'Kitchen' ? 'bg-red-400' : staff.role === 'Barista' ? 'bg-amber-400' : 'bg-green-400'}`}></span>
                                                                        <div>
                                                                            <div className="font-medium text-slate-700 flex items-center gap-1">
                                                                                {staff.name}
                                                                                {staff.isSubstitute && <span title="Substitute Role" className="text-[9px] bg-slate-200 text-slate-600 px-1 rounded">SUB</span>}
                                                                            </div>
                                                                            <div className="text-[10px] uppercase text-slate-400">{staff.role}</div>
                                                                        </div>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                        {/* SHIFT 2 */}
                                                        <div className="p-4 bg-amber-50/50 md:col-span-2 relative">
                                                            <div className="absolute top-0 right-0 bg-amber-500 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">PRIME (8)</div>
                                                            <div className="flex items-center gap-2 mb-3"><span className="bg-amber-100 text-amber-800 text-[10px] font-bold px-2 py-0.5 rounded">SORE</span></div>
                                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                                <ul className="space-y-2">
                                                                    {currentRoster[day].s2.slice(0, 4).map(staff => (
                                                                        <li key={staff.id} className="text-sm flex items-start gap-2">
                                                                            <span className={`w-2 h-2 mt-1.5 rounded-full ${staff.role === 'Kitchen' ? 'bg-red-400' : staff.role === 'Barista' ? 'bg-amber-400' : 'bg-green-400'}`}></span>
                                                                            <div>
                                                                                <div className="font-medium text-slate-800 flex items-center gap-1">
                                                                                    {staff.name} 
                                                                                    {staff.rank === 'Leader' && <Icons.Zap size={10} className="text-amber-600" fill="currentColor"/>}
                                                                                    {staff.isSubstitute && <span title="Substitute Role" className="text-[9px] bg-slate-200 text-slate-600 px-1 rounded">SUB</span>}
                                                                                </div>
                                                                                <div className="text-[10px] uppercase text-slate-500">{staff.role}</div>
                                                                            </div>
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                                <ul className="space-y-2">
                                                                    {currentRoster[day].s2.slice(4).map(staff => (
                                                                        <li key={staff.id} className="text-sm flex items-start gap-2">
                                                                            <span className={`w-2 h-2 mt-1.5 rounded-full ${staff.role === 'Kitchen' ? 'bg-red-400' : staff.role === 'Barista' ? 'bg-amber-400' : 'bg-green-400'}`}></span>
                                                                            <div>
                                                                                <div className="font-medium text-slate-800 flex items-center gap-1">
                                                                                    {staff.name}
                                                                                    {staff.isSubstitute && <span title="Substitute Role" className="text-[9px] bg-slate-200 text-slate-600 px-1 rounded">SUB</span>}
                                                                                </div>
                                                                                <div className="text-[10px] uppercase text-slate-500">{staff.role}</div>
                                                                            </div>
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        {/* SHIFT 3 */}
                                                        <div className="p-4 bg-indigo-50/30">
                                                            <div className="flex items-center gap-2 mb-3"><span className="bg-indigo-100 text-indigo-700 text-[10px] font-bold px-2 py-0.5 rounded">MALAM (3)</span></div>
                                                            <ul className="space-y-2">
                                                                {currentRoster[day].s3.map(staff => (
                                                                    <li key={staff.id} className="text-sm flex items-start gap-2">
                                                                        <span className={`w-2 h-2 mt-1.5 rounded-full ${staff.role === 'Kitchen' ? 'bg-red-400' : staff.role === 'Barista' ? 'bg-amber-400' : 'bg-green-400'}`}></span>
                                                                        <div>
                                                                            <div className="font-medium text-slate-700 flex flex-col">
                                                                                <span className="flex items-center gap-1">
                                                                                    {staff.name}
                                                                                    {staff.isSubstitute && <span title="Substitute Role" className="text-[9px] bg-slate-200 text-slate-600 px-1 rounded">SUB</span>}
                                                                                </span>
                                                                                {staff.isOverlap && <span className="mt-1 text-[9px] bg-red-100 text-red-700 border border-red-200 px-1 py-0.5 rounded font-bold w-fit">ðŸ’ª BANTU RUSH (20:00)</span>}
                                                                            </div>
                                                                            <div className="text-[10px] uppercase text-slate-400">{staff.role}</div>
                                                                        </div>
                                                                    </li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {/* LAPORAN BULANAN VIEW */}
                        {activeTab === 'report' && (
                            <div className="space-y-6">
                                {!monthlyStats ? (
                                    <div className="text-center py-20 bg-white rounded-xl border border-dashed border-slate-300">
                                        <Icons.FileText size={48} className="mx-auto text-slate-300 mb-4" />
                                        <p className="text-slate-500 mb-4">Silakan generate jadwal terlebih dahulu untuk melihat laporan.</p>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                        <div className="p-4 border-b border-slate-200 bg-slate-50">
                                            <h2 className="font-bold text-lg flex items-center gap-2">
                                                <Icons.FileText size={20} className="text-slate-600"/>
                                                Laporan Analisa Beban Kerja Bulanan
                                            </h2>
                                            <p className="text-sm text-slate-500">Total akumulasi kerja & libur selama 4 minggu (28 Hari).</p>
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-sm text-left">
                                                <thead className="bg-slate-100 text-slate-600 uppercase text-xs font-bold">
                                                    <tr>
                                                        <th className="px-6 py-3">Nama Karyawan</th>
                                                        <th className="px-6 py-3">Posisi</th>
                                                        <th className="px-6 py-3 text-center">Total Hari Kerja</th>
                                                        <th className="px-6 py-3 text-center">Total Libur</th>
                                                        <th className="px-6 py-3 text-center">Total Jam Kerja</th>
                                                        <th className="px-6 py-3 text-center">Rata-rata/Minggu</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="divide-y divide-slate-100">
                                                    {Object.values(monthlyStats).map((stat, idx) => (
                                                        <tr key={idx} className="hover:bg-slate-50">
                                                            <td className="px-6 py-3 font-medium text-slate-800">{stat.name}</td>
                                                            <td className="px-6 py-3">
                                                                <span className={`px-2 py-1 rounded text-xs font-bold ${stat.role === 'Kitchen' ? 'bg-red-100 text-red-700' : stat.role === 'Barista' ? 'bg-amber-100 text-amber-700' : stat.role === 'Kasir' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>{stat.role}</span>
                                                            </td>
                                                            <td className="px-6 py-3 text-center font-bold text-slate-700">{stat.totalWorkDays} Hari</td>
                                                            <td className="px-6 py-3 text-center text-slate-500">{stat.totalOffDays} Hari</td>
                                                            <td className="px-6 py-3 text-center">
                                                                <span className="font-bold text-slate-800">{stat.totalHours} Jam</span>
                                                            </td>
                                                            <td className="px-6 py-3 text-center text-xs text-slate-500">
                                                                ~{(stat.totalHours / 4).toFixed(1)} Jam/Mg
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                        <div className="p-4 bg-slate-50 text-xs text-slate-500 border-t border-slate-200">
                                            *Catatan: Shift 1 (8 Jam), Shift 2 (7 Jam), Shift 3 (9 Jam). Laporan ini membantu memastikan keadilan jam kerja.
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'employees' && (
                            <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                                <div className="p-4 border-b border-slate-200 bg-slate-50 flex justify-between items-center">
                                    <div><h2 className="font-bold text-lg">Database Karyawan ({employees.length})</h2><p className="text-xs text-slate-500">Kelola data tim Anda di sini.</p></div>
                                    <button onClick={() => handleOpenModal()} className="bg-slate-900 hover:bg-slate-800 text-white px-3 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><Icons.Plus size={16} /> Tambah Tim</button>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-100 text-slate-600 uppercase text-xs font-bold">
                                            <tr><th className="px-4 py-3">Nama</th><th className="px-4 py-3">Posisi</th><th className="px-4 py-3">Level</th><th className="px-4 py-3 text-right">Aksi</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {employees.map(emp => (
                                                <tr key={emp.id} className="hover:bg-slate-50">
                                                    <td className="px-4 py-3 font-medium text-slate-800">{emp.name}</td>
                                                    <td className="px-4 py-3"><span className={`px-2 py-1 rounded text-xs font-bold ${emp.role === 'Kitchen' ? 'bg-red-100 text-red-700' : emp.role === 'Barista' ? 'bg-amber-100 text-amber-700' : emp.role === 'Kasir' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}`}>{emp.role}</span></td>
                                                    <td className="px-4 py-3"><span className={`text-xs px-2 py-0.5 rounded border ${emp.rank === 'Leader' ? 'bg-yellow-100 border-yellow-200 text-yellow-800 font-bold' : emp.rank === 'Senior' ? 'bg-slate-100 border-slate-200 text-slate-700' : 'text-slate-500'}`}>{emp.rank || '-'}</span></td>
                                                    <td className="px-4 py-3 text-right flex justify-end gap-2">
                                                        <button onClick={() => handleOpenModal(emp)} className="p-1.5 text-blue-600 hover:bg-blue-50 rounded border border-transparent hover:border-blue-200 transition-colors" title="Edit"><Icons.Edit size={16} /></button>
                                                        <button onClick={() => handleDeleteEmployee(emp.id)} className="p-1.5 text-red-600 hover:bg-red-50 rounded border border-transparent hover:border-red-200 transition-colors" title="Hapus"><Icons.Trash2 size={16} /></button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </main>

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
                                <div className="px-6 py-4 bg-slate-900 text-white flex justify-between items-center">
                                    <h3 className="font-bold text-lg">{editingId ? 'Edit Data Karyawan' : 'Tambah Karyawan Baru'}</h3>
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-400 hover:text-white"><Icons.X size={20} /></button>
                                </div>
                                <form onSubmit={handleSaveEmployee} className="p-6 space-y-4">
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">Nama Lengkap</label><input type="text" required value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 outline-none" placeholder="Contoh: Budi Santoso"/></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="block text-sm font-medium text-slate-700 mb-1">Posisi / Role</label><select value={formData.role} onChange={(e) => setFormData({...formData, role: e.target.value})} className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 bg-white">{ROLES.map(r => <option key={r} value={r}>{r}</option>)}</select></div>
                                        <div><label className="block text-sm font-medium text-slate-700 mb-1">Level / Rank</label><select value={formData.rank} onChange={(e) => setFormData({...formData, rank: e.target.value})} className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500 bg-white">{RANKS.map(r => <option key={r} value={r}>{r}</option>)}</select></div>
                                    </div>
                                    <div className="pt-4 flex justify-end gap-3">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="px-4 py-2 text-slate-600 font-medium hover:bg-slate-100 rounded-lg">Batal</button>
                                        <button type="submit" className="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-black font-bold rounded-lg flex items-center gap-2"><Icons.Save size={18} /> Simpan Data</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PaybossRoster />);
    </script>
</body>
</html>
